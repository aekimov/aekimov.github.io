<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <h3>Mastering Table/Collection DiffableDataSource: A Comprehensive Guide</h3> <h4>This tutorial will demonstrate the process of refactoring and implementing DiffableDataSource in UITableView or UICollectionView.</h4> <p>This article is a follow-up to the previous <a href="https://medium.com/itnext/handling-multiple-requests-using-combine-in-swift-8e19e5c4fa52" rel="external nofollow noopener" target="_blank">one</a>.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*wyN-2smaYNMUvrL_4umICA.jpeg"><figcaption>Picture from <a href="https://www.flaticon.com/free-icon/menu_438886" rel="external nofollow noopener" target="_blank">Flaticon</a> by <a href="https://www.flaticon.com/authors/dinosoftlabs" rel="external nofollow noopener" target="_blank">DinosoftLabs</a></figcaption></figure> <h4>Summary</h4> <p>Currently, when we refresh a table view, all the cells get reloaded. This is acceptable in the present scenario as we anticipate receiving new data (a random number of jokes each time). However, let’s assume we have a feed of posts that infrequently updates, and reloading the entire table view each time results in unnecessary work. Another example would be when implementing pagination, where we add new items and then reload the entire table view, rather than just displaying the new items. We could achieve this without reloading all cells by using reloadRows(at: with:) or reloadItems(at:), but it would require additional calculations to provide accurate indexPaths. In such cases, using UITableViewDiffableDataSource can help us resolve these issues by managing all the complex operations and updating only the necessary changes in an efficient manner.</p> <p>The concept is to substitute the previous data source methods with UITableViewDiffableDataSource. Additionally, we had been manually refreshing the table view using the didSet property observation.</p> <iframe src="" width="0" height="0" frameborder="0" scrolling="no"><a href="https://medium.com/media/0ce11b20c8deaed4d5b29c0980a6e6b1/href" rel="external nofollow noopener" target="_blank">https://medium.com/media/0ce11b20c8deaed4d5b29c0980a6e6b1/href</a></iframe> <h4><strong>DiffableDataSource</strong></h4> <p>This is the object you use to manage data and provide cells for a table view.</p> <p>A <em>diffable data source</em> object is a specialized type of data source that works together with your table view object. It provides the behavior you need to manage updates to your table view’s data and UI in a simple, efficient way. It also conforms to the UITableViewDataSource protocol and provides implementations for all of the protocol’s methods.</p> <p>To connect a diffable data source to a table view, you create the diffable data source using its init(tableView:cellProvider:)initializer, passing in the table view you want to associate with that data source. You also pass in a cell provider, where you configure each of your cells to determine how to display your data in the UI.</p> <h4>Implementation</h4> <p>1. Create diffable data source and implement a cell provider to configure your table view’s cells.</p> <p>Within the angle brackets, we must indicate the section type as Int, and the model type as Joke, which must conform to the Hashable protocol.</p> <iframe src="" width="0" height="0" frameborder="0" scrolling="no"><a href="https://medium.com/media/b2afef33c349a5551da67b7bfc84687d/href" rel="external nofollow noopener" target="_blank">https://medium.com/media/b2afef33c349a5551da67b7bfc84687d/href</a></iframe> <p>2. Generate the current state of the data.</p> <p>Basically this is the code that we had in tableView(_:cellForRowAt:)</p> <iframe src="" width="0" height="0" frameborder="0" scrolling="no"><a href="https://medium.com/media/dd4532e70c7b91701895213f9e005294/href" rel="external nofollow noopener" target="_blank">https://medium.com/media/dd4532e70c7b91701895213f9e005294/href</a></iframe> <p>3. Display the data in the UI.</p> <p>We generate the current state of the data and display the data in the UI by constructing and applying a snapshot. Also in updateJokes we updating the snapshot with new items. This way we can get rid of jokes property array that we set before.</p> <iframe src="" width="0" height="0" frameborder="0" scrolling="no"><a href="https://medium.com/media/56dc713d144a1df639842bd8282306d9/href" rel="external nofollow noopener" target="_blank">https://medium.com/media/56dc713d144a1df639842bd8282306d9/href</a></iframe> <p>4. <strong>Don’f forget </strong>to connect a diffable data source to your table view.</p> <pre>tableView.dataSource = dataSource</pre> <h4>iOS 15 Update</h4> <p>Apple changed the behavior of the method apply(_:animatingDifferences:) of the UITableViewDiffableDataSource and UICollectionViewDiffableDataSource classes.</p> <p>On iOS 14 and before, calling apply(snapshot, animatingDifferences: false) was equivalent to calling reloadData. And calling apply(snapshot, animatingDifferences: true) would perform a diff on the data source and only update cells that the data changed.</p> <p>As of iOS 15, applying a snapshot using this API will <strong>always</strong> perform a diff, optionally animate the UI updates based on the value of animatingDifferences.</p> <p>To explicitly reload the whole table/collection without diffing, you can now call applySnapshotUsingReloadData(_:completion:) instead.</p> <p>Please bear in mind the distinction and select the methods that are appropriate for your requirements.</p> <p>The project is available on <a href="https://github.com/aekimov/CombineMultipleRequests" rel="external nofollow noopener" target="_blank">GitHub</a>.</p> <p>Thank you for taking the time to read this article. I hope it has been beneficial for you. Feel free to leave a comment or ask any questions you may have.</p> <p><img src="https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=4a0fe5f323de" width="1" height="1" alt="">&lt;hr&gt;&lt;p&gt;<a href="https://itnext.io/mastering-table-collection-view-diffabledatasource-a-comprehensive-guide-4a0fe5f323de" rel="external nofollow noopener" target="_blank">Mastering Table/Collection View DiffableDataSource: A Comprehensive Guide</a> was originally published in <a href="https://itnext.io" rel="external nofollow noopener" target="_blank">ITNEXT</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.&lt;/p&gt;</p> </body></html>